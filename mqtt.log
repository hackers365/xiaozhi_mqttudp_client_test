2025-05-03 17:49:57,651[src.protocols.mqtt_protocol] - INFO - MQTT配置: mqtt.xiaozhi.me, GID_test@@@ba_8f_17_de_94_95@@@75deb975-540e-4436-bb74-c73856c8c519, eyJpcCI6IjEuMjAzLjExMS45OSJ9, qTuSEsrqFHWsnNRtga19Bp0jjE7XgeOcsM5u0mNK4oM=, device-server, null - Thread-2 (_run_event_loop)
2025-05-03 17:49:57,652[src.protocols.mqtt_protocol] - INFO - 已从OTA服务器获取MQTT配置: mqtt.xiaozhi.me - Thread-2 (_run_event_loop)
2025-05-03 17:49:57,677[src.protocols.mqtt_protocol] - INFO - 正在连接MQTT服务器: mqtt.xiaozhi.me - Thread-2 (_run_event_loop)
2025-05-03 17:49:57,873[src.protocols.mqtt_protocol] - INFO - 已连接到MQTT服务器 - paho-mqtt-client-GID_test@@@ba_8f_17_de_94_95@@@75deb975-540e-4436-bb74-c73856c8c519
2025-05-03 17:49:57,876[src.protocols.mqtt_protocol] - INFO - 发送MQTT消息: {"type": "hello", "version": 3, "transport": "udp", "audio_params": {"format": "opus", "sample_rate": 24000, "channels": 1, "frame_duration": 20}} - Thread-2 (_run_event_loop)
收到MQTT消息 {"type":"hello","version":3,"session_id":"29f15278","transport":"udp","udp":{"server":"120.24.160.13","port":8842,"encryption":"aes-128-ctr","key":"c692a5cbe671f44e35361ddb112753e3","nonce":"01000000c416c5c90000000000000000"},"audio_params":{"format":"opus","sample_rate":24000,"channels":1,"frame_duration":20}}
服务链接返回初始化配置 {'type': 'hello', 'version': 3, 'session_id': '29f15278', 'transport': 'udp', 'udp': {'server': '120.24.160.13', 'port': 8842, 'encryption': 'aes-128-ctr', 'key': 'c692a5cbe671f44e35361ddb112753e3', 'nonce': '01000000c416c5c90000000000000000'}, 'audio_params': {'format': 'opus', 'sample_rate': 24000, 'channels': 1, 'frame_duration': 20}}
2025-05-03 17:49:57,940[src.protocols.mqtt_protocol] - INFO - 收到服务器hello响应，UDP服务器: 120.24.160.13:8842 - paho-mqtt-client-GID_test@@@ba_8f_17_de_94_95@@@75deb975-540e-4436-bb74-c73856c8c519
2025-05-03 17:49:57,941[src.application] - INFO - 音频通道已打开 - Thread-2 (_run_event_loop)
2025-05-03 17:49:57,941[src.application] - INFO - 物联网设备状态已更新(完整) - Thread-2 (_run_event_loop)
2025-05-03 17:49:57,942[src.protocols.mqtt_protocol] - INFO - UDP接收线程已启动，监听来自 120.24.160.13:8842 的数据 - Thread-5 (_udp_receive_thread)
2025-05-03 17:49:57,942[src.protocols.mqtt_protocol] - INFO - 发送MQTT消息: {"session_id": "29f15278", "type": "iot", "descriptors": [{"name": "Lamp", "description": "\u4e00\u4e2a\u6d4b\u8bd5\u7528\u7684\u706f", "properties": {"power": {"description": "\u706f\u662f\u5426\u6253\u5f00", "type": "boolean"}}, "methods": {"TurnOn": {"description": "\u6253\u5f00\u706f", "parameters": {}}, "TurnOff": {"description": "\u5173\u95ed\u706f", "parameters": {}}}}, {"name": "Speaker", "description": "\u5f53\u524d AI \u673a\u5668\u4eba\u7684\u626c\u58f0\u5668", "properties": {"volume": {"description": "\u5f53\u524d\u97f3\u91cf\u503c", "type": "number"}}, "methods": {"SetVolume": {"description": "\u8bbe\u7f6e\u97f3\u91cf", "parameters": {"volume": {"description": "0\u5230100\u4e4b\u95f4\u7684\u6574\u6570", "type": "number"}}}}}, {"name": "MusicPlayer", "description": "\u5728\u7ebf\u97f3\u4e50\u64ad\u653e\u5668,\u64ad\u653e\u97f3\u4e50\u65f6\u4f18\u5148\u4f7f\u7528iot\u7684\u97f3\u4e50\u64ad\u653e\u5668\uff0c\u652f\u6301\u672c\u5730\u7f13\u5b58\u3001\u6682\u505c\u3001\u8fdb\u5ea6\u8df3\u8f6c", "properties": {"current_song": {"description": "\u5f53\u524d\u6b4c\u66f2", "type": "string"}, "is_playing": {"description": "\u662f\u5426\u6b63\u5728\u64ad\u653e", "type": "boolean"}, "paused": {"description": "\u662f\u5426\u6682\u505c", "type": "boolean"}, "total_duration": {"description": "\u6b4c\u66f2\u603b\u65f6\u957f\uff08\u79d2\uff09", "type": "number"}, "current_position": {"description": "\u5f53\u524d\u64ad\u653e\u4f4d\u7f6e\uff08\u79d2\uff09", "type": "number"}, "progress": {"description": "\u64ad\u653e\u8fdb\u5ea6\uff08\u767e\u5206\u6bd4\uff09", "type": "number"}}, "methods": {"SearchPlay": {"description": "\u641c\u7d22\u5e76\u64ad\u653e\u6307\u5b9a\u6b4c\u66f2", "parameters": {"song_name": {"description": "\u8f93\u5165\u6b4c\u66f2\u540d\u79f0", "type": "string"}}}, "SearchSong": {"description": "\u4ec5\u641c\u7d22\u6b4c\u66f2\u4e0d\u64ad\u653e", "parameters": {"song_name": {"description": "\u8f93\u5165\u6b4c\u66f2\u540d\u79f0", "type": "string"}}}, "PlayPause": {"description": "\u64ad\u653e/\u6682\u505c\u5207\u6362", "parameters": {}}, "Stop": {"description": "\u505c\u6b62\u64ad\u653e", "parameters": {}}, "Seek": {"description": "\u8df3\u8f6c\u5230\u6307\u5b9a\u4f4d\u7f6e", "parameters": {"position_seconds": {"description": "\u8df3\u8f6c\u4f4d\u7f6e\uff08\u79d2\uff09", "type": "number"}}}, "GetLyrics": {"description": "\u83b7\u53d6\u5f53\u524d\u6b4c\u66f2\u6b4c\u8bcd", "parameters": {}}}}, {"name": "Camera", "description": "\u6444\u50cf\u5934\u7ba1\u7406", "properties": {"power": {"description": "\u6444\u50cf\u5934\u662f\u5426\u6253\u5f00", "type": "boolean"}, "result": {"description": "\u8bc6\u522b\u753b\u9762\u7684\u5185\u5bb9", "type": "string"}}, "methods": {"start_camera": {"description": "\u6253\u5f00\u6444\u50cf\u5934", "parameters": {}}, "stop_camera": {"description": "\u5173\u95ed\u6444\u50cf\u5934", "parameters": {}}, "capture_frame_to_base64": {"description": "\u8bc6\u522b\u753b\u9762", "parameters": {}}}}, {"name": "CountdownTimer", "description": "\u4e00\u4e2a\u7528\u4e8e\u5ef6\u8fdf\u6267\u884c\u547d\u4ee4\u7684\u5012\u8ba1\u65f6\u5668", "properties": {}, "methods": {"StartCountdown": {"description": "\u542f\u52a8\u4e00\u4e2a\u5012\u8ba1\u65f6\uff0c\u7ed3\u675f\u540e\u6267\u884c\u6307\u5b9a\u547d\u4ee4", "parameters": {"command": {"description": "\u8981\u6267\u884c\u7684IoT\u547d\u4ee4 (JSON\u683c\u5f0f\u5b57\u7b26\u4e32)", "type": "string"}, "delay": {"description": "\u5ef6\u8fdf\u65f6\u95f4\uff08\u79d2\uff09\uff0c\u9ed8\u8ba4\u4e3a5\u79d2", "type": "integer"}}}, "CancelCountdown": {"description": "\u53d6\u6d88\u6307\u5b9a\u7684\u5012\u8ba1\u65f6", "parameters": {"timer_id": {"description": "\u8981\u53d6\u6d88\u7684\u8ba1\u65f6\u5668ID", "type": "integer"}}}}}]} - Thread-2 (_run_event_loop)
2025-05-03 17:49:57,943[src.protocols.mqtt_protocol] - INFO - 发送MQTT消息: {"session_id": "29f15278", "type": "iot", "states": [{"name": "Lamp", "state": {"power": false}}, {"name": "Speaker", "state": {"volume": 100}}, {"name": "MusicPlayer", "state": {"current_song": "", "is_playing": false, "paused": false, "total_duration": 0, "current_position": 0, "progress": 0}}, {"name": "Camera", "state": {"power": false, "result": ""}}, {"name": "CountdownTimer", "state": {}}]} - Thread-2 (_run_event_loop)
2025-05-03 17:49:57,943[src.audio_codecs.audio_codec] - INFO - 使用默认设备: MacBook Pro麦克风 (Index: 0) - Thread-1 (_main_loop)
2025-05-03 17:49:57,988[src.audio_codecs.audio_codec] - INFO - 音频输入流重新初始化成功 - Thread-1 (_main_loop)
2025-05-03 17:49:57,989[src.protocols.mqtt_protocol] - INFO - 发送MQTT消息: {"session_id": "29f15278", "type": "listen", "state": "start", "mode": "manual"} - Thread-2 (_run_event_loop)
2025-05-03 17:49:58,001[src.application] - INFO - 已启动输入事件触发线程 - Thread-1 (_main_loop)
2025-05-03 17:49:58,002[src.application] - INFO - 已启动输出事件触发线程 - Thread-1 (_main_loop)
2025-05-03 17:49:58,002[src.application] - INFO - 音频流已启动 - Thread-1 (_main_loop)
2025-05-03 17:49:58,002[src.application] - INFO - 物联网设备状态已更新(增量) - Thread-1 (_main_loop)
2025-05-03 17:49:58,002[src.protocols.mqtt_protocol] - INFO - 发送MQTT消息: {"session_id": "29f15278", "type": "iot", "states": [{"name": "Lamp", "state": {"power": false}}, {"name": "Speaker", "state": {"volume": 100}}, {"name": "MusicPlayer", "state": {"current_song": "", "is_playing": false, "paused": false, "total_duration": 0, "current_position": 0, "progress": 0}}, {"name": "Camera", "state": {"power": false, "result": ""}}, {"name": "CountdownTimer", "state": {}}]} - Thread-2 (_run_event_loop)
2025-05-03 17:49:59,496[src.protocols.mqtt_protocol] - INFO - 发送MQTT消息: {"session_id": "29f15278", "type": "listen", "state": "stop"} - Thread-2 (_run_event_loop)
收到MQTT消息 {"type":"tts","state":"start","sample_rate":24000,"session_id":"29f15278"}
收到MQTT消息 {"type":"stt","text":"你好。","session_id":"29f15278"}
2025-05-03 17:49:59,643[src.application] - INFO - >> 你好。 - Thread-2 (_run_event_loop)
收到MQTT消息 {"type":"llm","text":"😊","emotion":"happy","session_id":"29f15278"}
2025-05-03 17:49:59,875[Display] - INFO - 设置表情GIF: /Users/shijingbo/git/py-xiaozhi/assets/emojis/happy.gif - Thread-1 (_main_loop)
2025-05-03 17:49:59,946[Display] - INFO - 加载GIF文件: /Users/shijingbo/git/py-xiaozhi/assets/emojis/happy.gif - MainThread
收到MQTT消息 {"type":"tts","state":"sentence_start","text":"你好，我在呢。","session_id":"29f15278"}
2025-05-03 17:50:00,021[src.application] - INFO - << 你好，我在呢。 - Thread-2 (_run_event_loop)
收到MQTT消息 {"type":"tts","state":"sentence_end","text":"你好，我在呢。","session_id":"29f15278"}
收到MQTT消息 {"type":"tts","state":"sentence_start","text":"有什么好玩的事吗？","session_id":"29f15278"}
2025-05-03 17:50:02,135[src.application] - INFO - << 有什么好玩的事吗？ - Thread-2 (_run_event_loop)
收到MQTT消息 {"type":"tts","state":"sentence_end","text":"有什么好玩的事吗？","session_id":"29f15278"}
收到MQTT消息 {"type":"tts","state":"stop","session_id":"29f15278"}
2025-05-03 17:50:04,544[Display] - INFO - 设置表情GIF: /Users/shijingbo/git/py-xiaozhi/assets/emojis/neutral.gif - Thread-1 (_main_loop)
2025-05-03 17:50:04,646[Display] - INFO - 加载GIF文件: /Users/shijingbo/git/py-xiaozhi/assets/emojis/neutral.gif - MainThread
收到MQTT消息 {"type":"goodbye","session_id":"29f15278"}
2025-05-03 17:51:11,675[src.protocols.mqtt_protocol] - INFO - UDP接收线程已停止 - Thread-5 (_udp_receive_thread)
2025-05-03 17:51:11,679[src.protocols.mqtt_protocol] - INFO - UDP接收线程已停止 - Thread-2 (_run_event_loop)
2025-05-03 17:51:12,181[src.protocols.mqtt_protocol] - INFO - MQTT连接已断开，返回码: 0 - Thread-2 (_run_event_loop)
2025-05-03 17:51:12,188[src.application] - INFO - 音频通道已关闭 - Thread-2 (_run_event_loop)
2025-05-03 17:51:12,189[src.application] - INFO - 音频通道已关闭 - Thread-2 (_run_event_loop)
